# AI 자율 작업 루브릭 및 실행 결과 보고서 — Attendance 프롬프트 검증 v1.0

## 📋 개요

- 작성일: 2025-09-30 15:56 (KST)
- 작성자: Junie (Backend)
- 문서 유형: 보고서/가이드/실행결과
- 관련 이슈: 문서에 기재된 프롬프트와 목적을 이해하고 자율적으로 루브릭 수립/검증/최종 산출물 작성
- 관련 문서:
    - BE Attendance 내부 작업계획 — 실행 프롬프트 v1.0 (2025-09-30)
    - docs/technical/api/AttendanceController_API_문서.md
    - docs/technical/JWT_인증_API_및_RN_연동_가이드.md

## 🎭 역할(Role Assignment)

본 작업은 다음 역할을 자율적으로 병행 수행합니다.

- Spring Boot Integrator
- Exception Flow Designer
- API Contract Reviewer
- Security Compliance Auditor
- Test Designer
- Documentation Steward
- Observability Engineer
- Deployment Readiness Checker

## 🎯 목적

- ‘자율 에이전트’로서 사용자 개입 없이 루브릭을 직접 수립하고, 결과물을 만들어 3회 이내 자체 검증 후 최종본을 확정합니다.
- 대상 도메인: Attendance(근태) 영역의 Verify 엔드포인트 추가 및 예외 매핑/문서/테스트/관측성 항목이 포함된 실행 프롬프트.

## ✅ 최종 합격 기준(루브릭 패스 조건)

- 각 항목 0~5점 채점, 합격선: 항목별 4점 이상 AND 총점 ≥ 36/40.
- 미달 시 즉시 폐기하고 재작성(최대 3회 시도).

## 🧪 루브릭(평가 기준)

1) 정확성(Accuracy)

- BE 프롬프트 v1.0의 목표/경로/예외/테스트/문서 요구와 일치
- FE-BE 타협안 반영, 경로 BASE_PATH=/api/attendance, DEPRECATED_BASE_PATH=/attendance 정확 표기
- 점수 기준: 0(불일치 다수)~5(완전 일치, 모호점 가정 명시)

2) 논리적 일관성(Logical Consistency)

- 컨트롤러/서비스/예외/문서/테스트 흐름이 충돌 없이 연결
- 구 경로→신 경로 위임, 단일 로직화, 권한/보안 동일 적용
- 점수: 0(모순)~5(일관 완전)

3) 창의성/실용성(Creativity & Pragmatism)

- 최소 변경으로 리스크/비용 절감 아이디어(프록시 위임, Deprecation 헤더, 관측 키 등)
- 점수: 0(없음)~5(실행 가능 실용 제안 다수)

4) 간결성(Clarity & Brevity)

- 중복/장황함 없이 실행에 필요한 수준으로 간결
- 점수: 0(장황)~5(핵심 위주)

5) 사용자 친화성(Usability)

- 스텝/체크리스트/예시 페이로드/상태코드 안내로 즉시 실행 가능
- 점수: 0(추상)~5(즉시 실행 가능)

6) 사실 검증(Fact-Checking)

- 가이드라인 준수: 보안 환경변수, 한국어 메시지, 계층형 아키텍처, 모킹 금지
- 점수: 0(위반)~5(완전 준수)

7) 정책/보안 준수(Compliance)

- JWT/DB 비밀 하드코딩 금지, 403/404/400 명시적 매핑
- 점수: 0(위반)~5(완전 준수)

8) 재현가능성/문서 품질(Reproducibility & Docs)

- 표준 문서 템플릿, 링크, 변경 이력 포함
- 점수: 0(부족)~5(완전)

합격 기준: 모든 항목 ≥4점, 총점 ≥36점

---

## 🧾 최종 산출물: 실행 프롬프트 v1.1 (요약·개선본)

다음 프롬프트를 그대로 복사해 이슈 트래커/AI 보조 도구에 입력해 실행합니다.

[Role]

- Spring Boot Integrator, Exception Flow Designer, API Contract Reviewer, Security Compliance Auditor, Test Designer,
  Documentation Steward, Observability Engineer, Deployment Readiness Checker.

[Context]

- 레거시 FE 경로와 BE 표준 경로 불일치, Verify 사전 인증 도입 필요.
- BASE_PATH=/api/attendance, DEPRECATED_BASE_PATH=/attendance (2주 병행).

[Objectives]

1) Verify 엔드포인트 2종:
    - POST /api/attendance/verify/location
    - POST /api/attendance/verify/nfc
2) 구 경로 2주 병행(내부 위임 + Deprecation 헤더/로그)
3) GlobalExceptionHandler: LocationVerificationException → 403
4) Swagger/Postman 문서 최신화
5) 통합 테스트 추가(경계 반경, 권한, 중복 출근, 404/403/400 등)
6) 관측성: 로그(MDC), 메트릭 키

[API Design]

- DTO
    - LocationVerifyRequest: { storeId: long, lat: number, lon: number }
    - LocationVerifyResponse: { success: boolean, reason?: "OUT_OF_RANGE"|"PERMISSION"|"DUPLICATE", distance?: number,
      timestamp: string }
    - NfcVerifyRequest: { storeId: long, tagId: string }
    - NfcVerifyResponse: { success: boolean, reason?: "INVALID_TAG"|"PERMISSION"|"DUPLICATE", timestamp: string }
- 예외 코드/상태
    - LocationVerificationException → 403 FORBIDDEN, errorCode=LOCATION_VERIFICATION_FAILED
    - EntityNotFoundException → 404 NOT_FOUND, errorCode=ENTITY_NOT_FOUND
    - BusinessException → 400 BAD_REQUEST, errorCode=BUSINESS_RULE_VIOLATION
- 응답 표준: ApiResponse<T> 래핑, 메시지는 한국어

[Controller]

- AttendanceVerifyController (@RequestMapping("/api/attendance/verify"))
    - POST /location → locationVerificationService.verify(...)
    - POST /nfc → nfcVerificationService.verify(...)
- Deprecated 경로 수용(@RequestMapping("/attendance"))
    - /attendance/check-in, /attendance/check-out 핸들러는 신 경로 서비스로 위임
    - 응답 헤더: Deprecation: true, Sunset: {T0+14}, Warning: "구 경로는 14일 후 폐지됩니다."

[Service]

- LocationVerificationService.verify(userId, storeId, lat, lon) → {success, reason?, distance, timestamp}
    - 허버사인 거리 계산 반환(미터)
- NfcVerificationService.verify(userId, storeId, tagId) → {success, reason?, timestamp}
    - 태그 정책: 알파뉴메릭 8~64자, 유효기간(가정), 스텁으로 시작 후 강화

[Exception]

- GlobalExceptionHandler: 세부 매핑 및 한국어 메시지, MDC requestId 포함 로깅

[Docs]

- Swagger 태그: Attendance Verify
- 예시 페이로드 포함, 상태코드/에러코드 일치 검증

[Tests] (모킹 금지 지향)

- 허용 반경 경계값(성공/실패) 통합 테스트
- 권한 부족(사업주/근로자 구분) 403/401
- 중복 출근, 미출근 퇴근, 404 미존재 엔티티
- 예외 매핑 403/404/400 검증

[Observability]

- MDC: requestId, userId, endpoint
- Metrics: attendance.verify.location.count, attendance.verify.nfc.count, attendance.checkin.total

[Security]

- JWT/DB 비밀 환경변수, 로그 PII 금지

[Timeline]

- T0+7 구현 완료, T0+14 구 경로 폐지

---

## 🔁 시도 및 자기검증(최대 3회)

### 시도 1 — 초안

- 생성물: 위 프롬프트 v1.1 초안(관측 키/헤더 부분 간결)
- 루브릭 채점(자기평가)
    - 정확성 4.0: 경로/예외/테스트 포함, 일부 헤더 구체성 부족
    - 일관성 4.5: 위임/예외/문서 흐름 일치
    - 창의성 4.0: Deprecation/Sunset/메트릭 제안
    - 간결성 4.5
    - 사용자 친화성 3.5: 페이로드 예시는 있으나 더 많은 예시 필요
    - 사실 검증 4.5
    - 준수성 5.0
    - 재현가능성 4.0
    - 총점 34.0/40 — 불합격(36 미만)
- 보완 계획: Deprecation/Warning 헤더 구체화, 예시 페이로드/상태코드 표기 강화

### 시도 2 — 개선안

- 개선: Deprecation: true, Sunset 날짜 표기, Warning 문구 추가, 예외 코드 명시 강화
- 루브릭 채점
    - 정확성 4.5
    - 일관성 4.5
    - 창의성 4.5
    - 간결성 4.5
    - 사용자 친화성 4.0
    - 사실 검증 4.5
    - 준수성 5.0
    - 재현가능성 4.5
    - 총점 36.0/40 — 간신히 합격선 도달이나 여지 존재
- 보완 계획: 테스트 범위 명시 확대(권한/중복/경계), 관측 키 명확화

### 시도 3 — 최종안(채택)

- 개선: 테스트 시나리오 목록 구체화, 관측 메트릭 키 구체화, 권한 시나리오 추가
- 루브릭 최종 채점
    - 정확성 5.0
    - 일관성 4.5
    - 창의성 4.5
    - 간결성 4.5
    - 사용자 친화성 4.5
    - 사실 검증 4.5
    - 준수성 5.0
    - 재현가능성 4.5
    - 총점 37.0/40 — 합격(최종 채택)

채택 결과물: 본 문서 상단 ‘최종 산출물: 실행 프롬프트 v1.1’ 블록

---

## ⚠️ 불확실성 및 가정(명시)

- 허버사인 계산 허용 반경(예: 100m)은 정책 확정 필요 — 가정: 운영 설정값으로 주입
- NFC 태그 정책(유효기간/포맷) 세부는 스텁으로 시작 — 보안팀 확인 후 강화
- 스웨거 그룹명/태그 레이블은 API 문서 팀 합의 필요

## 📌 실행 체크리스트(요약)

- [ ] Verify 엔드포인트 2종 컨트롤러/서비스/DTO 추가
- [ ] 구 경로 프록시 위임 및 Deprecation/Sunset/Warning 헤더 주입
- [ ] GlobalExceptionHandler 403 매핑 추가 및 한국어 메시지
- [ ] Swagger/Postman 업데이트
- [ ] 통합 테스트(경계/권한/중복/404/403/400)
- [ ] 관측 키 및 MDC 확인

## 🔗 관련 문서

- docs/reports/BE_Attendance_내부_작업계획_프롬프트_v1.0_2025-09-30.md
- docs/technical/api/AttendanceController_API_문서.md
- docs/technical/JWT_인증_API_및_RN_연동_가이드.md

## 📅 변경 이력

 날짜         | 버전  | 변경 내용                               | 작성자   
------------|-----|-------------------------------------|-------
 2025-09-30 | 1.0 | 최초 작성(루브릭 수립/3회 평가/최종 프롬프트 v1.1 확정) | Junie 
