# Spring Boot 프로젝트 코드베이스 분석 보고서

## 📋 분석 개요

- **프로젝트명**: sodam (근태 및 급여 관리 시스템)
- **분석 일시**: 2024년 12월 27일
- **분석 범위**: 전체 Java 소스 코드, 설정 파일, 빌드 스크립트
- **분석 목적**: 오류, 중복, 성능 문제, 보안 취약점, 유지보수성 저해 요소 식별

## 🚨 발견된 문제점 요약

### 1. 보안 취약점 (심각도: 높음)

#### 1.1 Spring Security 설정 문제

- **위치**: `src/main/java/com/rich/sodam/config/SecurityConfig.java:56`
- **문제**: `.anyRequest().permitAll()` - 모든 요청을 인증 없이 허용
- **위험도**: 매우 높음
- **영향**: 전체 시스템의 보안이 무력화됨

#### 1.2 민감 정보 하드코딩

- **위치**: `src/main/resources/application.yml`
- **문제**:
    - DB 비밀번호 평문 노출 (line 27: `password: Cv93523827!!`)
    - JWT Secret 평문 노출 (line 84: `secret: 2b$12$KIX2P6E/7N9yC6n6t1eO9uY5tC6k0e9h8f0K1hY4kz0e9f8f5eF1O`)
    - Kakao OAuth 클라이언트 시크릿 노출 (line 10: `client-secret: 2d79ffccdd762489eb43c16413922309`)
- **위험도**: 높음
- **영향**: 인증 정보 유출 시 시스템 전체 침해 가능

#### 1.3 JWT 토큰 처리 문제

- **위치**: `src/main/java/com/rich/sodam/jwt/JwtTokenProvider.java:134-139`
- **문제**: `resolveToken()` 메서드에서 "Bearer " 접두사 제거 없이 전체 헤더 반환
- **위험도**: 중간
- **영향**: JWT 토큰 검증 실패 가능성

### 2. 설정 파일 중복 및 일관성 문제

#### 2.1 애플리케이션 설정 중복

- **위치**:
    - `src/main/resources/application.properties`
    - `src/main/resources/application.yml`
- **문제**: 두 설정 파일이 동시 존재하며 애플리케이션 이름이 다름 (sodam vs devho)
- **영향**: 설정 충돌 및 예측 불가능한 동작

#### 2.2 Redis 설정 누락

- **위치**: `src/main/resources/application.yml`
- **문제**: Redis 의존성은 있지만 연결 설정이 없음
- **영향**: Redis 기능 사용 불가 또는 기본 설정 의존

### 3. 성능 최적화 필요 지점

#### 3.1 N+1 쿼리 문제

- **위치**: `src/main/java/com/rich/sodam/service/AttendanceService.java:184-194`
- **문제**: `getEmployeeStoreContext()` 메서드에서 3번의 개별 DB 조회
- **영향**: 데이터베이스 성능 저하

#### 3.2 Repository 메서드 중복

- **위치**: `src/main/java/com/rich/sodam/repository/AttendanceRepository.java`
- **문제**:
    - `findByEmployeeProfile_IdAndCheckInTimeBetweenOrderByCheckInTimeDesc` (line 49)
    - `findByEmployeeIdAndCheckInTimeBetween` (line 59)
    - 동일한 기능의 메서드 중복
- **영향**: 코드 복잡성 증가, 유지보수 어려움

#### 3.3 비효율적인 쿼리

- **위치**: `src/main/java/com/rich/sodam/repository/AttendanceRepository.java:42`
- **문제**: `FUNCTION('DATE', ...)` 사용으로 인덱스 활용 불가
- **영향**: 쿼리 성능 저하

### 4. 코드 중복 및 일관성 문제

#### 4.1 거리 계산 로직 중복

- **위치**:
    - `src/main/java/com/rich/sodam/domain/Store.java:185-199` (calculateDistance 메서드)
    - `src/main/java/com/rich/sodam/util/GeoUtils.java:25-36` (calculateDistance 메서드)
- **문제**: 동일한 Haversine 공식 구현이 두 곳에 존재
- **영향**: 코드 중복, 유지보수 복잡성

#### 4.2 예외 처리 일관성 부족

- **위치**: `src/main/java/com/rich/sodam/exception/GlobalExceptionHandler.java`
- **문제**:
    - EntityNotFoundException이 두 번 처리됨 (line 57, 94)
    - ErrorCode 사용과 하드코딩 문자열 혼재
- **영향**: 예외 처리 동작 예측 어려움

#### 4.3 Bean 중복 등록

- **위치**: `src/main/java/com/rich/sodam/config/SecurityConfig.java:34-41`
- **문제**: BCryptPasswordEncoder가 두 번 빈으로 등록됨
- **영향**: 메모리 낭비, 설정 복잡성

### 5. 유지보수성 저해 요소

#### 5.1 개발 중 주석 잔존

- **위치**:
    - `src/main/java/com/rich/sodam/domain/Attendance.java:52` ("Attendance.java에 추가할 메서드")
    - `src/main/java/com/rich/sodam/service/AttendanceService.java:99` ("DateTimeUtils 활용으로 개선 필요")
- **문제**: 개발 과정에서 남긴 임시 주석들이 정리되지 않음
- **영향**: 코드 가독성 저하

#### 5.2 하드코딩된 값들

- **위치**:
    - `src/main/java/com/rich/sodam/domain/Store.java:53` (radius 기본값 100)
    - `src/main/java/com/rich/sodam/config/RedisConfig.java:21` (localhost:6379)
- **문제**: 설정값들이 코드에 하드코딩됨
- **영향**: 환경별 설정 변경 어려움

#### 5.3 캡슐화 위반

- **위치**: `src/main/java/com/rich/sodam/domain/Store.java:20`
- **문제**: 클래스 레벨 @Setter로 모든 필드가 외부에서 변경 가능
- **영향**: 데이터 무결성 위험

### 6. 미사용 코드

#### 6.1 미사용 메서드

- **위치**: `src/main/java/com/rich/sodam/domain/Store.java:185-199`
- **문제**: `calculateDistance()` 메서드가 정의되어 있지만 사용되지 않음
- **영향**: 코드 복잡성 증가

#### 6.2 중복 Redis 템플릿

- **위치**: `src/main/java/com/rich/sodam/config/RedisConfig.java:30-48`
- **문제**: `jwtRedisTemplate`과 `redisTemplate`이 동일한 설정으로 중복 생성
- **영향**: 메모리 낭비

## 🔧 개선 방안 제안

### 1. 보안 강화 (우선순위: 최고)

#### 1.1 Spring Security 설정 수정

```java
// SecurityConfig.java 수정 필요
.authorizeHttpRequests(auth -> auth
    .requestMatchers("/api/auth/**", "/swagger-ui/**", "/api-docs/**").permitAll()
    .anyRequest().authenticated()
)
```

#### 1.2 민감 정보 환경변수화

```yaml
# application.yml 수정
spring:
  datasource:
    password: ${DB_PASSWORD:defaultPassword}
jwt:
  secret: ${JWT_SECRET:defaultSecret}
```

#### 1.3 JWT 토큰 처리 개선

```java
// JwtTokenProvider.java 수정
public String resolveToken(HttpServletRequest req) {
    String bearerToken = req.getHeader("Authorization");
    if (bearerToken != null && bearerToken.startsWith("Bearer ")) {
        return bearerToken.substring(7);
    }
    return null;
}
```

### 2. 성능 최적화

#### 2.1 N+1 문제 해결

```java
// Repository에 Fetch Join 추가
@Query("SELECT a FROM Attendance a " +
       "JOIN FETCH a.employeeProfile " +
       "JOIN FETCH a.store " +
       "WHERE a.employeeProfile.id = :employeeId")
List<Attendance> findByEmployeeIdWithDetails(@Param("employeeId") Long employeeId);
```

#### 2.2 중복 Repository 메서드 정리

- 기능이 중복되는 메서드들을 하나로 통합
- 명명 규칙 일관성 확보

### 3. 코드 중복 제거

#### 3.1 거리 계산 로직 통합

- Store 클래스의 calculateDistance 메서드 제거
- GeoUtils 사용으로 통일

#### 3.2 설정 파일 정리

- application.properties 제거
- application.yml로 통일

### 4. 유지보수성 개선

#### 4.1 하드코딩 값 설정화

```yaml
# application.yml에 추가
app:
  store:
    default-radius: 100
  redis:
    host: ${REDIS_HOST:localhost}
    port: ${REDIS_PORT:6379}
```

#### 4.2 캡슐화 강화

- 클래스 레벨 @Setter 제거
- 필요한 필드만 개별 setter 제공

## 📊 예상 개선 효과

### 보안 측면

- 인증/인가 시스템 정상 작동
- 민감 정보 유출 위험 제거
- JWT 토큰 처리 안정성 향상

### 성능 측면

- 데이터베이스 쿼리 수 감소 (N+1 문제 해결)
- 메모리 사용량 최적화
- 응답 시간 개선

### 유지보수 측면

- 코드 중복 제거로 유지보수 비용 절감
- 설정 관리 일원화
- 코드 가독성 및 이해도 향상

## ⚠️ 주의사항

1. **보안 설정 변경 시**: 기존 API 클라이언트에 영향을 줄 수 있으므로 단계적 적용 필요
2. **데이터베이스 쿼리 변경 시**: 성능 테스트를 통한 검증 필요
3. **설정 파일 변경 시**: 모든 환경(개발, 테스트, 운영)에서 동일하게 적용 필요

## 📝 권장 적용 순서

1. **1단계**: 보안 취약점 해결 (최우선)
2. **2단계**: 설정 파일 정리 및 환경변수화
3. **3단계**: 코드 중복 제거
4. **4단계**: 성능 최적화
5. **5단계**: 유지보수성 개선

---

**승인 요청**: 위 분석 결과와 개선 방안에 대한 검토 및 승인을 요청드립니다. 승인 후 단계별로 개선 작업을 진행하겠습니다.
