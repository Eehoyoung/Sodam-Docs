# 소담(SODAM) 애플리케이션 시작 실패 로그 분석 및 해결방안 보고서

## 📋 개요

- **작성일**: 2025-01-10
- **작성자**: 시스템 분석가
- **문서 유형**: 분석 보고서
- **관련 이슈**: Spring Boot 애플리케이션 시작 실패

## 🎯 목적

Spring Boot 애플리케이션 시작 실패 로그를 분석하여 정확한 원인을 파악하고, 구체적인 해결방안을 제시합니다.

## 📊 프로젝트 파악 결과 (3회 실시)

### 1차 파악: 전체 구조 및 설정 파일 분석

- **대상 파일**: `src/main/resources/application.yml`
- **주요 발견사항**:
    - 데이터베이스 설정이 `spring.datasource.hikari.*` 형태로 구성됨
    - `jdbc-url` 사용 (표준 `url` 대신)
    - 환경변수들이 `#{null}` 기본값으로 설정됨

### 2차 파악: 데이터베이스 설정 및 관련 클래스 분석

- **대상 파일**: `src/main/java/com/rich/sodam/config/DatabaseConfig.java`
- **주요 발견사항**:
    - `@Value("${spring.datasource.url}")` 형태로 플레이스홀더 참조
    - application.yml의 설정 경로와 불일치 발견
    - HikariCP 수동 설정으로 인한 설정 중복

### 3차 파악: Redis 설정 및 리포지토리 구조 분석

- **대상 파일**: `src/main/java/com/rich/sodam/config/RedisConfig.java`
- **주요 발견사항**:
    - JWT용과 캐시용 Redis 연결 분리 설정
    - Spring Data Redis 리포지토리 스캔 경고 발생
    - CustomCacheErrorHandler 정상 등록 확인

## 🔍 로그 분석 결과

### 핵심 오류 (라인 147)

```
Caused by: org.springframework.util.PlaceholderResolutionException: 
Could not resolve placeholder 'spring.datasource.url' in value "${spring.datasource.url}"
```

### 오류 발생 경로 추적

1. **최상위 오류** (라인 49): `observationRegistryPostProcessor` 빈 생성 실패
2. **중간 오류** (라인 70): `transactionAspect` 빈 생성 실패
3. **근본 원인** (라인 124): `databaseConfig` 빈 의존성 주입 실패
4. **직접 원인** (라인 147): 플레이스홀더 해결 실패

### 부수적 문제점

- **Redis 리포지토리 경고** (라인 21-37): JPA 리포지토리들이 Redis 리포지토리로 오인됨
- **BeanPostProcessor 경고** (라인 39-41): 빈 후처리기 순서 문제

## 🎯 원인 분석

### 주요 원인: 설정 경로 불일치

| 구성 요소    | application.yml                              | DatabaseConfig.java                   | 상태    |
|----------|----------------------------------------------|---------------------------------------|-------|
| URL      | `spring.datasource.hikari.jdbc-url`          | `spring.datasource.url`               | ❌ 불일치 |
| Username | `spring.datasource.hikari.username`          | `spring.datasource.username`          | ❌ 불일치 |
| Password | `spring.datasource.hikari.password`          | `spring.datasource.password`          | ❌ 불일치 |
| Driver   | `spring.datasource.hikari.driver-class-name` | `spring.datasource.driver-class-name` | ❌ 불일치 |

### 부수적 원인

1. **Spring Data 모듈 충돌**: JPA와 Redis 리포지토리 스캔 충돌
2. **빈 생성 순서**: 캐시 관련 빈들의 생성 순서 문제
3. **프로파일 설정**: `@Profile("!test")` 설정으로 인한 테스트 환경 분리

## 💡 해결방안

### 방안 1: DatabaseConfig 수정 (권장)

**장점**: 기존 application.yml 구조 유지, 최소한의 변경
**단점**: 수동 HikariCP 설정 유지

```java
// DatabaseConfig.java 수정 필요 부분
@Value("${spring.datasource.hikari.jdbc-url}")
private String jdbcUrl;

@Value("${spring.datasource.hikari.username}")
private String username;

@Value("${spring.datasource.hikari.password}")
private String password;

@Value("${spring.datasource.hikari.driver-class-name}")
private String driverClassName;
```

### 방안 2: application.yml 수정

**장점**: Spring Boot 표준 설정 준수
**단점**: 기존 설정 구조 변경 필요

```yaml
spring:
  datasource:
    url: ${DB_URL:jdbc:mysql://localhost:3306/sodam?serverTimezone=Asia/Seoul}
    username: ${DB_USERNAME:root}
    password: ${DB_PASSWORD:#{null}}
    driver-class-name: ${DB_DRIVER_CLASS_NAME:com.mysql.cj.jdbc.Driver}
    hikari:
      # 기존 hikari 설정들...
```

### 방안 3: DatabaseConfig 제거 (최적)

**장점**: Spring Boot 자동 설정 활용, 코드 간소화
**단점**: 기존 커스텀 설정 손실

## 🔧 수정 및 빌드 명령어

### ⚠️ 승인 요청

다음 수정 및 빌드 관련 터미널 명령어들의 실행에 대한 승인을 요청합니다:

#### 1. 소스 코드 수정

```bash
# DatabaseConfig.java 파일 수정
# - @Value 어노테이션의 플레이스홀더 경로 수정
# - spring.datasource.* → spring.datasource.hikari.*
```

#### 2. 빌드 및 테스트

```bash
# 프로젝트 빌드
./gradlew clean build

# 애플리케이션 시작 테스트
./gradlew bootRun

# 단위 테스트 실행
./gradlew test
```

#### 3. 환경변수 설정 확인

```bash
# .env 파일 또는 환경변수 확인
# DB_URL, DB_USERNAME, DB_PASSWORD 등의 값 설정 확인
```

## 📈 예상 효과

### 즉시 효과

- ✅ 애플리케이션 시작 성공
- ✅ 데이터베이스 연결 정상화
- ✅ Spring Context 초기화 완료

### 장기적 효과

- 🔧 시스템 안정성 향상
- 📊 모니터링 및 디버깅 용이성 증대
- 🚀 개발 생산성 향상

## 🔗 관련 문서

- [개발 가이드라인](../guidelines/development_guidelines.md)
- [데이터베이스 설정 가이드](../technical/데이터베이스_설정_가이드.md)
- [Redis 캐시 전략 문서](../technical/Redis_캐시_전략_문서.md)

## 📅 변경 이력

| 날짜         | 버전  | 변경 내용 | 작성자     |
|------------|-----|-------|---------|
| 2025-01-10 | 1.0 | 초기 작성 | 시스템 분석가 |

---

**승인 대기 중**: 위에 명시된 수정 및 빌드 관련 터미널 명령어들의 실행 승인을 기다리고 있습니다.
