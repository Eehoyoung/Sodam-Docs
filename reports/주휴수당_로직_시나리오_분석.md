# 소담(SODAM) 주휴수당 로직 시나리오 분석

## 📋 개요

- **작성일**: 2025-01-15
- **작성자**: AI 분석 시스템
- **문서 유형**: 로직 분석 보고서
- **관련 이슈**: 주휴수당 로직 시나리오 분석 요청

## 🎯 목적

소담(SODAM) 애플리케이션의 주휴수당 계산 로직을 3가지 구체적인 시나리오를 통해 설명하고, 각 상황별 계산 과정과 결과를 상세히 제시합니다.

## 🔍 주휴수당 계산 로직 개요

### 📊 기본 규칙

1. **지급 조건**: 주 15시간 이상 근무
2. **계산 공식**: 주휴수당 = 평균 일급 × 0.2 (평균 일급의 1/5)
3. **계산 주기**: 입사일 기준 주 단위 (7일)
4. **실행 시점**: 매일 23:40 스케줄러 실행
5. **저장 위치**: 해당 주의 마지막 출근 기록에 저장

### 💰 계산 과정

```java
// 1. 주간 총 근무시간 계산
BigDecimal weeklyHours = calculateWeeklyHours(attendances);

// 2. 15시간 미만 체크
if (weeklyHours.compareTo(new BigDecimal(15)) < 0) {
    return; // 주휴수당 미지급
}

// 3. 평균 일급 계산
int totalWage = 0;
for (Attendance attendance : attendances) {
    totalWage += attendance.calculateDailyWage(); // 근무시간 × 시급
}
BigDecimal avgDailyWage = BigDecimal.valueOf(totalWage).divide(BigDecimal.valueOf(workDays), 2, RoundingMode.HALF_UP);

// 4. 주휴수당 계산
BigDecimal weeklyAllowance = avgDailyWage.multiply(BigDecimal.valueOf(0.2));
```

## 📝 시나리오 분석

### 🟢 시나리오 1: 주휴수당 지급 조건을 완전히 만족하는 경우

#### 👤 직원 정보

- **이름**: 김알바
- **입사일**: 2025년 1월 6일 (월요일)
- **시급**: 10,000원
- **주휴수당 계산 기간**: 2025년 1월 6일 ~ 1월 12일 (7일간)

#### 📅 근무 기록

| 날짜       | 요일  | 출근시간  | 퇴근시간  | 근무시간 | 일급      |
|----------|-----|-------|-------|------|---------|
| 1/6 (월)  | 월요일 | 09:00 | 13:00 | 4시간  | 40,000원 |
| 1/7 (화)  | 화요일 | 14:00 | 18:00 | 4시간  | 40,000원 |
| 1/8 (수)  | 수요일 | 10:00 | 15:00 | 5시간  | 50,000원 |
| 1/10 (금) | 금요일 | 09:00 | 14:00 | 5시간  | 50,000원 |
| 1/11 (토) | 토요일 | 10:00 | 13:00 | 3시간  | 30,000원 |

#### 💡 계산 과정

```
1. 주간 총 근무시간: 4 + 4 + 5 + 5 + 3 = 21시간 ✅ (15시간 이상)

2. 총 임금 계산:
   - 월요일: 4시간 × 10,000원 = 40,000원
   - 화요일: 4시간 × 10,000원 = 40,000원
   - 수요일: 5시간 × 10,000원 = 50,000원
   - 금요일: 5시간 × 10,000원 = 50,000원
   - 토요일: 3시간 × 10,000원 = 30,000원
   총 임금: 210,000원

3. 근무일수: 5일

4. 평균 일급: 210,000원 ÷ 5일 = 42,000원

5. 주휴수당: 42,000원 × 0.2 = 8,400원
```

#### ✅ 결과

- **주휴수당**: **8,400원 지급**
- **저장 위치**: 1월 11일(토) 출근 기록에 저장
- **지급 사유**: 주 21시간 근무로 15시간 조건 충족

---

### 🔴 시나리오 2: 주휴수당 지급 조건을 만족하지 않는 경우

#### 👤 직원 정보

- **이름**: 박단시간
- **입사일**: 2025년 1월 13일 (월요일)
- **시급**: 9,860원 (최저시급)
- **주휴수당 계산 기간**: 2025년 1월 13일 ~ 1월 19일 (7일간)

#### 📅 근무 기록

| 날짜       | 요일  | 출근시간  | 퇴근시간  | 근무시간 | 일급      |
|----------|-----|-------|-------|------|---------|
| 1/13 (월) | 월요일 | 14:00 | 17:00 | 3시간  | 29,580원 |
| 1/15 (수) | 수요일 | 16:00 | 19:00 | 3시간  | 29,580원 |
| 1/17 (금) | 금요일 | 10:00 | 14:00 | 4시간  | 39,440원 |
| 1/19 (일) | 일요일 | 15:00 | 18:00 | 3시간  | 29,580원 |

#### 💡 계산 과정

```
1. 주간 총 근무시간: 3 + 3 + 4 + 3 = 13시간 ❌ (15시간 미만)

2. 조건 체크:
   if (weeklyHours.compareTo(new BigDecimal(15)) < 0) {
       return; // 주휴수당 미지급
   }
   
   13시간 < 15시간 → 조건 불충족
```

#### ❌ 결과

- **주휴수당**: **0원 (미지급)**
- **미지급 사유**: 주 13시간 근무로 15시간 조건 미충족
- **개선 방안**: 주 2시간 추가 근무 필요

---

### 🟡 시나리오 3: 경계선상의 경우 (정확히 15시간 근무)

#### 👤 직원 정보

- **이름**: 이경계
- **입사일**: 2025년 1월 20일 (월요일)
- **시급**: 12,000원
- **주휴수당 계산 기간**: 2025년 1월 20일 ~ 1월 26일 (7일간)

#### 📅 근무 기록

| 날짜       | 요일  | 출근시간  | 퇴근시간  | 근무시간 | 일급      |
|----------|-----|-------|-------|------|---------|
| 1/20 (월) | 월요일 | 09:00 | 14:00 | 5시간  | 60,000원 |
| 1/22 (수) | 수요일 | 14:00 | 19:00 | 5시간  | 60,000원 |
| 1/24 (금) | 금요일 | 10:00 | 15:00 | 5시간  | 60,000원 |

#### 💡 계산 과정

```
1. 주간 총 근무시간: 5 + 5 + 5 = 15시간 ✅ (정확히 15시간)

2. 조건 체크:
   if (weeklyHours.compareTo(new BigDecimal(15)) < 0) {
       return; // 15시간 이상이므로 통과
   }
   
   15시간 ≥ 15시간 → 조건 충족

3. 총 임금 계산:
   - 월요일: 5시간 × 12,000원 = 60,000원
   - 수요일: 5시간 × 12,000원 = 60,000원
   - 금요일: 5시간 × 12,000원 = 60,000원
   총 임금: 180,000원

4. 근무일수: 3일

5. 평균 일급: 180,000원 ÷ 3일 = 60,000원

6. 주휴수당: 60,000원 × 0.2 = 12,000원
```

#### ✅ 결과

- **주휴수당**: **12,000원 지급**
- **저장 위치**: 1월 24일(금) 출근 기록에 저장
- **지급 사유**: 정확히 주 15시간 근무로 최소 조건 충족
- **특이사항**: 경계선상이지만 조건 충족으로 지급

## 🔧 기술적 구현 세부사항

### 📅 주 단위 계산 로직

```java
// 입사일 기준 주 시작/종료일 설정
LocalDate startDate = employee.getStartWeeklyAllowance(); // 입사일
LocalDate endDate = employee.getEndWeeklyAllowance();     // 입사일 + 6일

// 다음 주 설정 (주가 완료된 후)
employee.setStartWeeklyAllowance(endDate.plusDays(1));   // 다음 주 월요일
employee.setEndWeeklyAllowance(endDate.plusDays(7));     // 다음 주 일요일
```

### ⏰ 스케줄러 실행

```java
@Scheduled(cron = "0 40 23 * * ?") // 매일 23:40 실행
@Transactional
public void calculateWeeklyAllowances() {
    List<EmployeeProfile> employees = employeeProfileRepository.findAll();
    
    for (EmployeeProfile employee : employees) {
        calculateAndUpdateWeeklyAllowance(employee);
    }
}
```

### 💾 데이터 저장

```java
// 마지막 출근기록에 주휴수당 저장
Attendance lastAttendance = recentAttendances.get(0);
lastAttendance.setWeeklyAllowance(weeklyAllowance);
attendanceRepository.save(lastAttendance);
```

## 📊 주휴수당 지급 통계 예시

### 월간 주휴수당 현황 (2025년 1월 기준)

| 구분  | 대상 직원 수 | 지급 대상     | 미지급 대상   | 평균 지급액  |
|-----|---------|-----------|----------|---------|
| 1주차 | 15명     | 12명 (80%) | 3명 (20%) | 9,500원  |
| 2주차 | 15명     | 13명 (87%) | 2명 (13%) | 10,200원 |
| 3주차 | 15명     | 11명 (73%) | 4명 (27%) | 8,800원  |
| 4주차 | 15명     | 14명 (93%) | 1명 (7%)  | 11,000원 |

### 시급별 주휴수당 예상액

| 시급      | 주 15시간 근무 시 | 주 20시간 근무 시 | 주 25시간 근무 시 |
|---------|-------------|-------------|-------------|
| 9,860원  | 2,958원      | 3,944원      | 4,930원      |
| 10,000원 | 3,000원      | 4,000원      | 5,000원      |
| 12,000원 | 3,600원      | 4,800원      | 6,000원      |
| 15,000원 | 4,500원      | 6,000원      | 7,500원      |

## ⚠️ 주의사항 및 예외 처리

### 🚨 예외 상황

1. **출근 기록 없음**: 해당 주에 출근 기록이 없으면 주휴수당 미지급
2. **퇴근 처리 안됨**: 출근만 하고 퇴근 처리가 안된 경우 해당 일은 근무시간 0으로 계산
3. **월말 경계**: 주 계산 기간이 월말을 넘어가는 경우 월말까지만 계산
4. **매장 변경**: 여러 매장에서 근무하는 경우 가장 빠른 입사일 기준으로 주 계산

### 🔄 시스템 동작

```java
// 퇴근 처리가 안된 경우
if (attendance.getCheckOutTime() != null) {
    double hours = attendance.getWorkingTimeInHours(); // 정상 계산
    totalHours = totalHours.add(BigDecimal.valueOf(hours));
} else {
    // 퇴근 처리 안됨 → 근무시간 0으로 처리
}
```

## 🎯 결론

### ✅ 주휴수당 로직 특징

1. **명확한 기준**: 주 15시간 이상 근무 시 지급
2. **공정한 계산**: 평균 일급의 20% 지급
3. **자동화**: 스케줄러를 통한 자동 계산 및 지급
4. **투명성**: 각 출근 기록에 주휴수당 내역 저장

### 📈 시스템 장점

- **정확성**: 입사일 기준 정확한 주 단위 계산
- **효율성**: 배치 처리를 통한 성능 최적화
- **추적성**: 모든 계산 과정 로그 및 데이터 보존
- **유연성**: 다양한 근무 패턴에 대응 가능

### 🔮 향후 개선 방안

1. **실시간 계산**: 퇴근 시점에 주휴수당 예상액 표시
2. **알림 기능**: 15시간 미달 시 직원/사업주에게 알림
3. **통계 대시보드**: 주휴수당 지급 현황 시각화
4. **정책 설정**: 매장별 주휴수당 정책 커스터마이징

## 🔗 관련 문서

- [급여 관리 시스템 가이드](../technical/급여_관리_시스템_가이드.md)
- [출퇴근 관리 API 문서](../technical/출퇴근_관리_API_문서.md)
- [백엔드 완성도 분석 보고서](./백엔드_완성도_분석_보고서.md)

## 📅 변경 이력

| 날짜         | 버전  | 변경 내용            | 작성자       |
|------------|-----|------------------|-----------|
| 2025-01-15 | 1.0 | 초기 시나리오 분석 문서 작성 | AI 분석 시스템 |

---
**문서 작성 완료일**: 2025-01-15  
**다음 검토 예정일**: 2025-02-15  
**담당자**: 백엔드 개발팀
