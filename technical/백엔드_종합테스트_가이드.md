# 소담(SODAM) 백엔드 종합테스트 가이드

## 📋 문서 개요

- **작성일**: 2025-01-27
- **작성자**: 시스템 분석팀
- **문서 유형**: 백엔드 종합테스트 가이드
- **대상**: 백엔드 개발자, QA 엔지니어
- **프로젝트**: 소담(SODAM) - 아르바이트 근태 및 급여 관리 애플리케이션
- **문서 버전**: 1.0

## 🎯 문서 목적

본 문서는 소담 애플리케이션의 백엔드 API만을 활용한 종합테스트를 위한 가이드입니다. 테스트 시나리오, 필요한 덤프 데이터, API 사용 순서를 제공하여 체계적인 백엔드 테스트를 지원합니다.

---

# 🗂️ 테스트 환경 설정

## 필수 환경변수 설정

```bash
# JWT 보안 설정
JWT_SECRET=your-256-bit-secret-key-here-for-testing
JWT_EXPIRATION=3600000
JWT_REFRESH_EXPIRATION=604800000

# 데이터베이스 설정
DB_URL=jdbc:mysql://localhost:3306/sodam_test
DB_USERNAME=sodam_test
DB_PASSWORD=test_password

# Redis 설정
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_PASSWORD=test_redis_password

# 카카오 OAuth 설정 (테스트용)
KAKAO_CLIENT_ID=test_kakao_client_id
KAKAO_CLIENT_SECRET=test_kakao_client_secret
```

## 테스트 데이터베이스 초기화

```sql
-- 테스트 데이터베이스 생성
CREATE DATABASE IF NOT EXISTS sodam_test CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
USE sodam_test;
```

---

# 📊 테스트용 덤프 데이터 (dump.sql)

## 1. 기본 테이블 생성

```sql
-- 사용자 테이블
CREATE TABLE users (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    email VARCHAR(255) NOT NULL UNIQUE,
    password VARCHAR(255),
    name VARCHAR(100) NOT NULL,
    phone_number VARCHAR(20),
    user_grade ENUM('USER', 'MASTER', 'ADMIN') DEFAULT 'USER',
    provider VARCHAR(50) DEFAULT 'LOCAL',
    provider_id VARCHAR(255),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);

-- 매장 테이블
CREATE TABLE store (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    road_address VARCHAR(500),
    jibun_address VARCHAR(500),
    latitude DECIMAL(10, 8),
    longitude DECIMAL(11, 8),
    radius INTEGER DEFAULT 100,
    business_number VARCHAR(20),
    phone_number VARCHAR(20),
    owner_id BIGINT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (owner_id) REFERENCES users(id)
);

-- 직원 프로필 테이블
CREATE TABLE employee_profile (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    user_id BIGINT NOT NULL,
    store_id BIGINT NOT NULL,
    hourly_wage INTEGER DEFAULT 10000,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(id),
    FOREIGN KEY (store_id) REFERENCES store(id),
    UNIQUE KEY unique_user_store (user_id, store_id)
);

-- 사장 프로필 테이블
CREATE TABLE master_profile (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    user_id BIGINT NOT NULL UNIQUE,
    business_name VARCHAR(255),
    business_number VARCHAR(20),
    business_address VARCHAR(500),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(id)
);

-- 출퇴근 기록 테이블
CREATE TABLE attendance (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    employee_id BIGINT NOT NULL,
    store_id BIGINT NOT NULL,
    check_in_time TIMESTAMP NOT NULL,
    check_out_time TIMESTAMP NULL,
    latitude DECIMAL(10, 8),
    longitude DECIMAL(11, 8),
    working_hours DECIMAL(5, 2) DEFAULT 0.00,
    status ENUM('CHECKED_IN', 'CHECKED_OUT') DEFAULT 'CHECKED_IN',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (employee_id) REFERENCES users(id),
    FOREIGN KEY (store_id) REFERENCES store(id)
);

-- 급여 테이블
CREATE TABLE payroll (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    employee_id BIGINT NOT NULL,
    store_id BIGINT NOT NULL,
    pay_period_start DATE NOT NULL,
    pay_period_end DATE NOT NULL,
    total_working_hours DECIMAL(8, 2) DEFAULT 0.00,
    regular_hours DECIMAL(8, 2) DEFAULT 0.00,
    overtime_hours DECIMAL(8, 2) DEFAULT 0.00,
    night_hours DECIMAL(8, 2) DEFAULT 0.00,
    holiday_hours DECIMAL(8, 2) DEFAULT 0.00,
    base_pay DECIMAL(12, 2) DEFAULT 0.00,
    overtime_pay DECIMAL(12, 2) DEFAULT 0.00,
    night_pay DECIMAL(12, 2) DEFAULT 0.00,
    holiday_pay DECIMAL(12, 2) DEFAULT 0.00,
    total_pay DECIMAL(12, 2) DEFAULT 0.00,
    deductions DECIMAL(12, 2) DEFAULT 0.00,
    net_pay DECIMAL(12, 2) DEFAULT 0.00,
    status ENUM('CALCULATED', 'CONFIRMED', 'PAID', 'CANCELLED') DEFAULT 'CALCULATED',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (employee_id) REFERENCES users(id),
    FOREIGN KEY (store_id) REFERENCES store(id)
);

-- 리프레시 토큰 테이블
CREATE TABLE refresh_token (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    user_id BIGINT NOT NULL,
    token VARCHAR(500) NOT NULL UNIQUE,
    expiry_date TIMESTAMP NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(id)
);

-- 직원-매장 관계 테이블
CREATE TABLE employee_store_relation (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    employee_id BIGINT NOT NULL,
    store_id BIGINT NOT NULL,
    hourly_wage INTEGER DEFAULT 10000,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (employee_id) REFERENCES users(id),
    FOREIGN KEY (store_id) REFERENCES store(id),
    UNIQUE KEY unique_employee_store (employee_id, store_id)
);

-- 사장-매장 관계 테이블
CREATE TABLE master_store_relation (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    master_id BIGINT NOT NULL,
    store_id BIGINT NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (master_id) REFERENCES users(id),
    FOREIGN KEY (store_id) REFERENCES store(id),
    UNIQUE KEY unique_master_store (master_id, store_id)
);
```

## 2. 테스트 데이터 삽입

```sql
-- 테스트 사용자 데이터
INSERT INTO users (email, password, name, phone_number, user_grade, provider) VALUES
('master@test.com', '$2a$10$N.zmdr9k7uOCQb376NoUnuTJ8iAt6Z5EHsM8lE9P8UzwNy.jjv2Lm', '김사장', '010-1111-1111', 'MASTER', 'LOCAL'),
('employee1@test.com', '$2a$10$N.zmdr9k7uOCQb376NoUnuTJ8iAt6Z5EHsM8lE9P8UzwNy.jjv2Lm', '이직원', '010-2222-2222', 'USER', 'LOCAL'),
('employee2@test.com', '$2a$10$N.zmdr9k7uOCQb376NoUnuTJ8iAt6Z5EHsM8lE9P8UzwNy.jjv2Lm', '박직원', '010-3333-3333', 'USER', 'LOCAL'),
('employee3@test.com', '$2a$10$N.zmdr9k7uOCQb376NoUnuTJ8iAt6Z5EHsM8lE9P8UzwNy.jjv2Lm', '최직원', '010-4444-4444', 'USER', 'LOCAL'),
('admin@test.com', '$2a$10$N.zmdr9k7uOCQb376NoUnuTJ8iAt6Z5EHsM8lE9P8UzwNy.jjv2Lm', '관리자', '010-0000-0000', 'ADMIN', 'LOCAL');

-- 테스트 매장 데이터
INSERT INTO store (name, road_address, jibun_address, latitude, longitude, radius, business_number, phone_number, owner_id) VALUES
('카페 소담 강남점', '서울 강남구 테헤란로 123', '서울 강남구 역삼동 123-45', 37.5665, 126.9780, 100, '123-45-67890', '02-1234-5678', 1),
('카페 소담 홍대점', '서울 마포구 홍익로 456', '서울 마포구 홍익동 456-78', 37.5563, 126.9236, 150, '234-56-78901', '02-2345-6789', 1),
('베이커리 소담', '서울 송파구 올림픽로 789', '서울 송파구 잠실동 789-12', 37.5133, 127.1028, 120, '345-67-89012', '02-3456-7890', 1);

-- 사장 프로필 데이터
INSERT INTO master_profile (user_id, business_name, business_number, business_address) VALUES
(1, '소담 F&B', '123-45-67890', '서울 강남구 테헤란로 123');

-- 직원 프로필 데이터
INSERT INTO employee_profile (user_id, store_id, hourly_wage) VALUES
(2, 1, 12000),  -- 이직원 - 강남점
(2, 2, 11000),  -- 이직원 - 홍대점
(3, 1, 10500),  -- 박직원 - 강남점
(4, 2, 11500),  -- 최직원 - 홍대점
(4, 3, 10000);  -- 최직원 - 베이커리점

-- 직원-매장 관계 데이터
INSERT INTO employee_store_relation (employee_id, store_id, hourly_wage) VALUES
(2, 1, 12000),
(2, 2, 11000),
(3, 1, 10500),
(4, 2, 11500),
(4, 3, 10000);

-- 사장-매장 관계 데이터
INSERT INTO master_store_relation (master_id, store_id) VALUES
(1, 1),
(1, 2),
(1, 3);

-- 테스트 출퇴근 기록 데이터 (최근 1주일)
INSERT INTO attendance (employee_id, store_id, check_in_time, check_out_time, latitude, longitude, working_hours, status) VALUES
-- 이직원 (ID: 2) - 강남점 근무
(2, 1, '2025-01-20 09:00:00', '2025-01-20 18:00:00', 37.5665, 126.9780, 9.0, 'CHECKED_OUT'),
(2, 1, '2025-01-21 09:30:00', '2025-01-21 17:30:00', 37.5665, 126.9780, 8.0, 'CHECKED_OUT'),
(2, 1, '2025-01-22 10:00:00', '2025-01-22 19:00:00', 37.5665, 126.9780, 9.0, 'CHECKED_OUT'),
-- 이직원 - 홍대점 근무
(2, 2, '2025-01-23 14:00:00', '2025-01-23 22:00:00', 37.5563, 126.9236, 8.0, 'CHECKED_OUT'),
(2, 2, '2025-01-24 15:00:00', '2025-01-24 23:00:00', 37.5563, 126.9236, 8.0, 'CHECKED_OUT'),

-- 박직원 (ID: 3) - 강남점 근무
(3, 1, '2025-01-20 10:00:00', '2025-01-20 19:00:00', 37.5665, 126.9780, 9.0, 'CHECKED_OUT'),
(3, 1, '2025-01-21 09:00:00', '2025-01-21 18:00:00', 37.5665, 126.9780, 9.0, 'CHECKED_OUT'),
(3, 1, '2025-01-22 11:00:00', '2025-01-22 20:00:00', 37.5665, 126.9780, 9.0, 'CHECKED_OUT'),

-- 최직원 (ID: 4) - 홍대점 근무
(4, 2, '2025-01-20 13:00:00', '2025-01-20 21:00:00', 37.5563, 126.9236, 8.0, 'CHECKED_OUT'),
(4, 2, '2025-01-21 14:00:00', '2025-01-21 22:00:00', 37.5563, 126.9236, 8.0, 'CHECKED_OUT'),
-- 최직원 - 베이커리점 근무
(4, 3, '2025-01-22 06:00:00', '2025-01-22 14:00:00', 37.5133, 127.1028, 8.0, 'CHECKED_OUT'),
(4, 3, '2025-01-23 06:30:00', '2025-01-23 14:30:00', 37.5133, 127.1028, 8.0, 'CHECKED_OUT');

-- 테스트 급여 데이터
INSERT INTO payroll (employee_id, store_id, pay_period_start, pay_period_end, total_working_hours, regular_hours, base_pay, total_pay, net_pay, status) VALUES
(2, 1, '2025-01-01', '2025-01-31', 160.0, 160.0, 1920000, 1920000, 1728000, 'CALCULATED'),
(3, 1, '2025-01-01', '2025-01-31', 150.0, 150.0, 1575000, 1575000, 1417500, 'CALCULATED'),
(4, 2, '2025-01-01', '2025-01-31', 140.0, 140.0, 1610000, 1610000, 1449000, 'CALCULATED');
```

## 3. 성능 최적화 인덱스 적용

```sql
-- 기존 인덱스 파일 실행
SOURCE src/main/resources/db/migration/V2__add_performance_indexes.sql;
```

---

# 🧪 종합테스트 시나리오

## 시나리오 1: 사용자 인증 및 권한 관리 테스트

### 1.1 일반 로그인 테스트

**목적**: 일반 사용자 로그인 기능 검증

**테스트 데이터**:

- 이메일: `employee1@test.com`
- 비밀번호: `password123`

**예상 결과**:

- 로그인 성공
- JWT 토큰 발급
- 사용자 정보 반환

### 1.2 사장 로그인 테스트

**목적**: 사장 권한 사용자 로그인 기능 검증

**테스트 데이터**:

- 이메일: `master@test.com`
- 비밀번호: `password123`

**예상 결과**:

- 로그인 성공
- MASTER 권한 확인
- 매장 관리 권한 부여

### 1.3 토큰 갱신 테스트

**목적**: JWT 토큰 갱신 기능 검증

**전제 조건**: 유효한 Refresh Token 보유

**예상 결과**:

- 새로운 Access Token 발급
- 새로운 Refresh Token 발급

## 시나리오 2: 매장 관리 기능 테스트

### 2.1 매장 등록 테스트

**목적**: 새로운 매장 등록 기능 검증

**테스트 데이터**:

```json
{
  "name": "테스트 카페",
  "query": "서울시 중구 명동길 100",
  "businessNumber": "456-78-90123",
  "phoneNumber": "02-4567-8901",
  "radius": 200
}
```

**예상 결과**:

- 매장 정보 저장
- 좌표 자동 변환
- 사장-매장 관계 생성

### 2.2 직원 할당 테스트

**목적**: 매장에 직원 할당 기능 검증

**테스트 데이터**:

- 매장 ID: 1
- 직원 ID: 2
- 시급: 13000

**예상 결과**:

- 직원-매장 관계 생성
- 시급 정보 저장

### 2.3 매장별 직원 목록 조회 테스트

**목적**: 매장에 소속된 직원 목록 조회 기능 검증

**예상 결과**:

- 해당 매장 직원 목록 반환
- 직원 기본 정보 포함

## 시나리오 3: 출퇴근 관리 기능 테스트

### 3.1 출근 처리 테스트

**목적**: GPS 기반 출근 처리 기능 검증

**테스트 데이터**:

```json
{
  "employeeId": 2,
  "storeId": 1,
  "latitude": 37.5665,
  "longitude": 126.9780
}
```

**예상 결과**:

- 위치 인증 성공
- 출근 기록 생성
- 상태: CHECKED_IN

### 3.2 퇴근 처리 테스트

**목적**: 퇴근 처리 및 근무 시간 계산 기능 검증

**전제 조건**: 해당 직원의 출근 기록 존재

**테스트 데이터**:

```json
{
  "employeeId": 2,
  "storeId": 1,
  "latitude": 37.5665,
  "longitude": 126.9780
}
```

**예상 결과**:

- 퇴근 시간 기록
- 근무 시간 자동 계산
- 상태: CHECKED_OUT

### 3.3 위치 인증 실패 테스트

**목적**: 매장 반경 밖에서 출퇴근 시도 시 처리 검증

**테스트 데이터**:

```json
{
  "employeeId": 2,
  "storeId": 1,
  "latitude": 37.4000,
  "longitude": 127.0000
}
```

**예상 결과**:

- 위치 인증 실패
- 에러 메시지 반환
- 출퇴근 기록 생성 안됨

### 3.4 출퇴근 기록 조회 테스트

**목적**: 직원별/매장별 출퇴근 기록 조회 기능 검증

**테스트 케이스**:

- 직원별 기록 조회: `/api/attendance/employee/2`
- 매장별 기록 조회: `/api/attendance/store/1`
- 월간 기록 조회: `/api/attendance/employee/2/monthly?year=2025&month=1`

**예상 결과**:

- 해당 조건의 출퇴근 기록 목록 반환
- 근무 시간 정보 포함

## 시나리오 4: 급여 관리 기능 테스트

### 4.1 기간별 급여 계산 테스트

**목적**: 특정 기간의 급여 자동 계산 기능 검증

**테스트 데이터**:

- 직원 ID: 2
- 매장 ID: 1
- 기간: 2025-01-01 ~ 2025-01-31

**예상 결과**:

- 해당 기간 근무 시간 집계
- 시급 기반 급여 계산
- 각종 수당 계산 (야간, 연장, 휴일)

### 4.2 급여 생성 및 상태 관리 테스트

**목적**: 급여 내역 생성 및 상태 변경 기능 검증

**테스트 데이터**:

```json
{
  "employeeId": 2,
  "storeId": 1,
  "startDate": "2025-01-01T00:00:00",
  "endDate": "2025-01-31T23:59:59"
}
```

**예상 결과**:

- 급여 내역 생성
- 상태: CALCULATED
- 상세 급여 정보 포함

### 4.3 급여 상태 업데이트 테스트

**목적**: 급여 상태 변경 기능 검증

**테스트 시나리오**:

1. CALCULATED → CONFIRMED
2. CONFIRMED → PAID
3. PAID → CANCELLED (예외 상황)

**예상 결과**:

- 상태 변경 성공
- 변경 이력 기록

### 4.4 급여 내역 조회 테스트

**목적**: 직원별/매장별 급여 내역 조회 기능 검증

**테스트 케이스**:

- 직원 급여 내역: `/api/payroll/employee/2`
- 매장 급여 내역: `/api/payroll/store/1`
- 급여 상세 내역: `/api/payroll/1/details`

**예상 결과**:

- 해당 조건의 급여 내역 목록 반환
- 급여 상세 정보 포함

## 시나리오 5: 통합 워크플로우 테스트

### 5.1 일일 근무 전체 플로우 테스트

**목적**: 출근부터 급여 계산까지 전체 프로세스 검증

**테스트 순서**:

1. 직원 로그인
2. 출근 처리
3. 퇴근 처리
4. 출퇴근 기록 확인
5. 급여 계산
6. 급여 내역 조회

**예상 결과**:

- 모든 단계 정상 처리
- 데이터 일관성 유지
- 캐시 동기화 정상

### 5.2 다중 매장 근무 테스트

**목적**: 한 직원이 여러 매장에서 근무하는 경우 처리 검증

**테스트 시나리오**:

- 직원 ID 2가 강남점과 홍대점에서 교대 근무
- 각 매장별 다른 시급 적용
- 매장별 급여 계산

**예상 결과**:

- 매장별 독립적인 출퇴근 기록
- 매장별 시급 정확 적용
- 매장별 급여 계산 정확성

---

# 📋 API 사용 순서 가이드

## 1단계: 환경 설정 및 인증

### 1.1 서버 시작 확인

```bash
# 서버 상태 확인
curl -X GET http://localhost:8080/actuator/health
```

### 1.2 사용자 로그인

```bash
# 직원 로그인
curl -X POST http://localhost:8080/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{
    "email": "employee1@test.com",
    "password": "password123"
  }'

# 응답에서 accessToken 저장
export ACCESS_TOKEN="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
```

### 1.3 사장 로그인

```bash
# 사장 로그인
curl -X POST http://localhost:8080/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{
    "email": "master@test.com",
    "password": "password123"
  }'

# 응답에서 accessToken 저장
export MASTER_TOKEN="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
```

## 2단계: 매장 관리 테스트

### 2.1 매장 목록 조회

```bash
# 사장의 매장 목록 조회
curl -X GET "http://localhost:8080/api/stores/master/1" \
  -H "Authorization: Bearer $MASTER_TOKEN"
```

### 2.2 매장 직원 목록 조회

```bash
# 특정 매장의 직원 목록 조회
curl -X GET "http://localhost:8080/api/stores/1/employees" \
  -H "Authorization: Bearer $MASTER_TOKEN"
```

### 2.3 새 매장 등록 (선택사항)

```bash
# 새 매장 등록
curl -X POST "http://localhost:8080/api/stores/change/master?userId=1" \
  -H "Authorization: Bearer $MASTER_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "name": "테스트 신규 매장",
    "query": "서울시 강서구 화곡로 100",
    "businessNumber": "999-88-77666",
    "phoneNumber": "02-9999-8888",
    "radius": 150
  }'
```

## 3단계: 출퇴근 관리 테스트

### 3.1 출근 처리

```bash
# 직원 출근 처리
curl -X POST http://localhost:8080/api/attendance/check-in \
  -H "Authorization: Bearer $ACCESS_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "employeeId": 2,
    "storeId": 1,
    "latitude": 37.5665,
    "longitude": 126.9780
  }'
```

### 3.2 퇴근 처리

```bash
# 직원 퇴근 처리 (출근 후 충분한 시간 경과 후)
curl -X POST http://localhost:8080/api/attendance/check-out \
  -H "Authorization: Bearer $ACCESS_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "employeeId": 2,
    "storeId": 1,
    "latitude": 37.5665,
    "longitude": 126.9780
  }'
```

### 3.3 출퇴근 기록 조회

```bash
# 직원별 출퇴근 기록 조회
curl -X GET "http://localhost:8080/api/attendance/employee/2?startDate=2025-01-01T00:00:00&endDate=2025-01-31T23:59:59" \
  -H "Authorization: Bearer $ACCESS_TOKEN"

# 매장별 출퇴근 기록 조회
curl -X GET "http://localhost:8080/api/attendance/store/1?startDate=2025-01-01T00:00:00&endDate=2025-01-31T23:59:59" \
  -H "Authorization: Bearer $MASTER_TOKEN"

# 월간 출퇴근 기록 조회
curl -X GET "http://localhost:8080/api/attendance/employee/2/monthly?year=2025&month=1" \
  -H "Authorization: Bearer $ACCESS_TOKEN"
```

## 4단계: 급여 관리 테스트

### 4.1 기간별 급여 계산

```bash
# 특정 기간 급여 계산
curl -X GET "http://localhost:8080/api/payroll/employee/2/store/1?startDate=2025-01-01T00:00:00&endDate=2025-01-31T23:59:59" \
  -H "Authorization: Bearer $ACCESS_TOKEN"
```

### 4.2 급여 생성

```bash
# 급여 내역 생성
curl -X POST http://localhost:8080/api/payroll/calculate \
  -H "Authorization: Bearer $MASTER_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "employeeId": 2,
    "storeId": 1,
    "startDate": "2025-01-01T00:00:00",
    "endDate": "2025-01-31T23:59:59"
  }'

# 응답에서 payrollId 저장
export PAYROLL_ID=1
```

### 4.3 급여 상태 변경

```bash
# 급여 상태를 CONFIRMED로 변경
curl -X PUT "http://localhost:8080/api/payroll/$PAYROLL_ID/status" \
  -H "Authorization: Bearer $MASTER_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "status": "CONFIRMED"
  }'

# 급여 상태를 PAID로 변경
curl -X PUT "http://localhost:8080/api/payroll/$PAYROLL_ID/status" \
  -H "Authorization: Bearer $MASTER_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "status": "PAID"
  }'
```

### 4.4 급여 내역 조회

```bash
# 직원 급여 내역 조회
curl -X GET "http://localhost:8080/api/payroll/employee/2?from=2025-01-01&to=2025-12-31" \
  -H "Authorization: Bearer $ACCESS_TOKEN"

# 매장 급여 내역 조회
curl -X GET "http://localhost:8080/api/payroll/store/1?from=2025-01-01&to=2025-12-31" \
  -H "Authorization: Bearer $MASTER_TOKEN"

# 급여 상세 내역 조회
curl -X GET "http://localhost:8080/api/payroll/$PAYROLL_ID/details" \
  -H "Authorization: Bearer $ACCESS_TOKEN"
```

### 4.5 직원 전체 매장 급여 정보 조회

```bash
# 직원이 근무하는 모든 매장의 급여 정보 조회
curl -X GET "http://localhost:8080/api/payroll/employee/2/wages" \
  -H "Authorization: Bearer $ACCESS_TOKEN"
```

## 5단계: 시급 관리 테스트

### 5.1 직원 시급 조회

```bash
# 특정 매장에서의 직원 시급 조회
curl -X GET "http://localhost:8080/api/wage/employee/2/store/1" \
  -H "Authorization: Bearer $ACCESS_TOKEN"
```

### 5.2 직원 시급 변경

```bash
# 직원 시급 업데이트
curl -X PUT "http://localhost:8080/api/wage/employee/2/store/1" \
  -H "Authorization: Bearer $MASTER_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "hourlyWage": 13500
  }'
```

### 5.3 매장 기본 시급 변경

```bash
# 매장 기본 시급 업데이트
curl -X PUT "http://localhost:8080/api/wage/store/1/standard" \
  -H "Authorization: Bearer $MASTER_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "standardWage": 11000
  }'
```

## 6단계: 토큰 관리 테스트

### 6.1 토큰 갱신

```bash
# Refresh Token을 사용한 토큰 갱신
curl -X POST http://localhost:8080/api/auth/refresh \
  -H "Content-Type: application/json" \
  -d '{
    "refreshToken": "your_refresh_token_here"
  }'
```

### 6.2 로그아웃

```bash
# 로그아웃 (토큰 무효화)
curl -X POST http://localhost:8080/api/auth/logout \
  -H "Authorization: Bearer $ACCESS_TOKEN"
```

---

# 🔍 테스트 검증 포인트

## 1. 기능적 검증 포인트

### 1.1 인증 및 권한

- [ ] 올바른 자격증명으로 로그인 성공
- [ ] 잘못된 자격증명으로 로그인 실패
- [ ] JWT 토큰 정상 발급 및 검증
- [ ] 권한별 API 접근 제어 (USER, MASTER, ADMIN)
- [ ] 토큰 만료 시 적절한 에러 처리
- [ ] Refresh Token을 통한 토큰 갱신

### 1.2 매장 관리

- [ ] 매장 등록 시 주소 → 좌표 변환
- [ ] 사장-매장 관계 정상 생성
- [ ] 직원 할당 및 시급 설정
- [ ] 매장별 직원 목록 조회
- [ ] 매장 위치 정보 업데이트

### 1.3 출퇴근 관리

- [ ] GPS 기반 위치 인증 성공/실패
- [ ] 출근 시간 정확 기록
- [ ] 퇴근 시간 및 근무 시간 자동 계산
- [ ] 중복 출근 방지
- [ ] 출퇴근 기록 조회 (직원별, 매장별, 기간별)

### 1.4 급여 관리

- [ ] 출퇴근 기록 기반 급여 자동 계산
- [ ] 시급별 정확한 급여 산출
- [ ] 야간/연장/휴일 수당 계산
- [ ] 급여 상태 관리 (CALCULATED → CONFIRMED → PAID)
- [ ] 급여 내역 조회 및 상세 정보

## 2. 성능 검증 포인트

### 2.1 응답 시간

- [ ] 로그인 API: 1초 이내
- [ ] 출퇴근 처리: 2초 이내
- [ ] 급여 계산: 5초 이내 (대용량 데이터)
- [ ] 목록 조회: 3초 이내

### 2.2 동시성 처리

- [ ] 동시 출퇴근 처리 시 데이터 일관성
- [ ] 동시 급여 계산 요청 처리
- [ ] 캐시 동기화 정상 작동

### 2.3 데이터베이스 성능

- [ ] 인덱스 활용 확인 (EXPLAIN 사용)
- [ ] 대용량 데이터 조회 성능
- [ ] 복합 조건 검색 성능

## 3. 보안 검증 포인트

### 3.1 인증 보안

- [ ] JWT Secret Key 환경변수 사용
- [ ] 토큰 만료 시간 적절 설정
- [ ] 비밀번호 해싱 (bcrypt) 적용
- [ ] SQL Injection 방지

### 3.2 권한 보안

- [ ] 타인의 데이터 접근 차단
- [ ] 매장별 데이터 접근 제한
- [ ] 관리자 전용 기능 접근 제어

### 3.3 데이터 보안

- [ ] 민감 정보 로깅 방지
- [ ] 에러 메시지에서 시스템 정보 노출 방지
- [ ] HTTPS 통신 (운영 환경)

## 4. 에러 처리 검증 포인트

### 4.1 비즈니스 로직 에러

- [ ] 존재하지 않는 사용자/매장 접근 시 적절한 에러
- [ ] 위치 인증 실패 시 명확한 에러 메시지
- [ ] 중복 출근 시도 시 에러 처리
- [ ] 급여 계산 불가 상황 에러 처리

### 4.2 시스템 에러

- [ ] 데이터베이스 연결 실패 처리
- [ ] Redis 연결 실패 처리
- [ ] 외부 API 호출 실패 처리 (카카오 지오코딩)

### 4.3 입력 검증 에러

- [ ] 필수 파라미터 누락 시 에러
- [ ] 잘못된 데이터 형식 입력 시 에러
- [ ] 범위를 벗어난 값 입력 시 에러

---

# 📊 테스트 결과 기록 템플릿

## 테스트 실행 정보

- **테스트 실행일**: YYYY-MM-DD
- **테스트 환경**: 로컬/개발/스테이징
- **테스트 실행자**: [이름]
- **데이터베이스 버전**: MySQL 8.x
- **애플리케이션 버전**: [버전]

## 시나리오별 테스트 결과

### 시나리오 1: 사용자 인증 및 권한 관리

| 테스트 케이스 | 상태  | 응답시간  | 비고 |
|---------|-----|-------|----|
| 일반 로그인  | ✅/❌ | 000ms |    |
| 사장 로그인  | ✅/❌ | 000ms |    |
| 토큰 갱신   | ✅/❌ | 000ms |    |
| 권한 검증   | ✅/❌ | 000ms |    |

### 시나리오 2: 매장 관리 기능

| 테스트 케이스  | 상태  | 응답시간  | 비고 |
|----------|-----|-------|----|
| 매장 등록    | ✅/❌ | 000ms |    |
| 직원 할당    | ✅/❌ | 000ms |    |
| 매장 목록 조회 | ✅/❌ | 000ms |    |
| 직원 목록 조회 | ✅/❌ | 000ms |    |

### 시나리오 3: 출퇴근 관리 기능

| 테스트 케이스   | 상태  | 응답시간  | 비고 |
|-----------|-----|-------|----|
| 출근 처리     | ✅/❌ | 000ms |    |
| 퇴근 처리     | ✅/❌ | 000ms |    |
| 위치 인증 실패  | ✅/❌ | 000ms |    |
| 출퇴근 기록 조회 | ✅/❌ | 000ms |    |

### 시나리오 4: 급여 관리 기능

| 테스트 케이스  | 상태  | 응답시간  | 비고 |
|----------|-----|-------|----|
| 급여 계산    | ✅/❌ | 000ms |    |
| 급여 생성    | ✅/❌ | 000ms |    |
| 급여 상태 변경 | ✅/❌ | 000ms |    |
| 급여 내역 조회 | ✅/❌ | 000ms |    |

### 시나리오 5: 통합 워크플로우

| 테스트 케이스      | 상태  | 응답시간  | 비고 |
|--------------|-----|-------|----|
| 일일 근무 전체 플로우 | ✅/❌ | 000ms |    |
| 다중 매장 근무     | ✅/❌ | 000ms |    |

## 발견된 이슈

| 이슈 번호 | 심각도             | 설명    | 재현 방법 | 상태         |
|-------|-----------------|-------|-------|------------|
| #001  | High/Medium/Low | 이슈 설명 | 재현 단계 | Open/Fixed |

## 성능 측정 결과

| API 엔드포인트                     | 평균 응답시간 | 최대 응답시간 | TPS | 비고 |
|-------------------------------|---------|---------|-----|----|
| POST /api/auth/login          | 000ms   | 000ms   | 000 |    |
| POST /api/attendance/check-in | 000ms   | 000ms   | 000 |    |
| GET /api/payroll/calculate    | 000ms   | 000ms   | 000 |    |

## 테스트 결론

- **전체 테스트 성공률**: 00%
- **주요 발견사항**:
- **권장사항**:
- **다음 단계**:

---

# 🔧 문제 해결 가이드

## 자주 발생하는 문제와 해결방법

### 1. 인증 관련 문제

#### 1.1 JWT 토큰 에러

**증상**: "Invalid JWT token" 에러
**원인**:

- JWT Secret Key 미설정
- 토큰 만료
- 잘못된 토큰 형식

**해결방법**:

```bash
# 환경변수 확인
echo $JWT_SECRET

# 새로운 토큰 발급
curl -X POST http://localhost:8080/api/auth/login ...
```

#### 1.2 권한 에러

**증상**: "Access Denied" 에러
**원인**:

- 잘못된 사용자 권한
- 토큰에 권한 정보 누락

**해결방법**:

- 사용자 권한 확인
- 올바른 권한의 사용자로 재로그인

### 2. 데이터베이스 관련 문제

#### 2.1 연결 실패

**증상**: "Connection refused" 에러
**원인**:

- MySQL 서버 미실행
- 잘못된 연결 정보

**해결방법**:

```bash
# MySQL 서버 상태 확인
sudo systemctl status mysql

# 연결 테스트
mysql -h localhost -u sodam_test -p sodam_test
```

#### 2.2 테이블 없음 에러

**증상**: "Table doesn't exist" 에러
**원인**:

- 테이블 생성 스크립트 미실행
- 잘못된 데이터베이스 선택

**해결방법**:

```sql
-- 테이블 존재 확인
SHOW TABLES;

-- 덤프 파일 재실행
SOURCE dump.sql;
```

### 3. Redis 관련 문제

#### 3.1 Redis 연결 실패

**증상**: "Could not connect to Redis" 에러
**원인**:

- Redis 서버 미실행
- 잘못된 Redis 설정

**해결방법**:

```bash
# Redis 서버 시작
redis-server

# 연결 테스트
redis-cli ping
```

### 4. 위치 인증 문제

#### 4.1 위치 인증 실패

**증상**: "Location verification failed" 에러
**원인**:

- GPS 좌표가 매장 반경 밖
- 잘못된 좌표 값

**해결방법**:

- 매장 좌표 및 반경 확인
- 테스트용 좌표 사용

### 5. 급여 계산 문제

#### 5.1 급여 계산 오류

**증상**: 급여 금액이 예상과 다름
**원인**:

- 출퇴근 기록 누락
- 시급 정보 오류
- 계산 로직 오류

**해결방법**:

- 출퇴근 기록 확인
- 시급 정보 확인
- 계산 로직 검토

---

# 📚 참고 자료

## API 문서

- [FE개발자를 위한 API 및 서비스로직 문서](./FE개발자를_위한_API_및_서비스로직_문서.md)
- Swagger UI: http://localhost:8080/swagger-ui.html

## 데이터베이스 스키마

- [데이터베이스 인덱스 최적화](../../../src/main/resources/db/migration/V2__add_performance_indexes.sql)

## 프로젝트 문서

- [프로젝트 기획서](../../project-management/project_planning_Document_v2.md)
- [개발 가이드라인](../../guidelines/development_guidelines.md)

## 외부 API

- [카카오 지오코딩 API](https://developers.kakao.com/docs/latest/ko/local/dev-guide)
- [카카오 로그인 API](https://developers.kakao.com/docs/latest/ko/kakaologin/rest-api)

---

# 📝 변경 이력

| 날짜         | 버전  | 변경 내용 | 작성자     |
|------------|-----|-------|---------|
| 2025-01-27 | 1.0 | 초기 작성 | 시스템 분석팀 |

---

**⚠️ 주의사항**

- 본 문서는 테스트 환경에서만 사용하세요
- 운영 환경에서는 보안 설정을 강화하세요
- 테스트 데이터는 정기적으로 정리하세요
- 성능 테스트 시 충분한 데이터를 준비하세요
