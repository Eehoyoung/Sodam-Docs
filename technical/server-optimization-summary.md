# 서버 비용 최소화를 위한 최적화 요약

이 문서는 서버 비용 최소화를 위해 수행된 최적화 작업을 요약합니다.

## 1. 캐싱 메커니즘 구현

### 1.1 Redis 캐시 설정

- `CacheConfig` 클래스 추가하여 Spring Cache 활성화
- 기본 캐시 TTL을 10분으로 설정하여 메모리 사용량 최적화
- 정책 정보 캐시는 1시간 TTL로 별도 설정

### 1.2 서비스 레이어 캐싱

- `PolicyInfoService`의 읽기 작업에 `@Cacheable` 적용
    - `getPolicyInfo`: 개별 정책 정보 캐싱
    - `getAllPolicyInfos`: 전체 정책 정보 목록 캐싱
    - `getRecentPolicyInfos`: 최근 정책 정보 목록 캐싱
- 쓰기 작업에 `@CacheEvict` 적용하여 캐시 일관성 유지
    - `createPolicyInfo`: 관련 캐시 모두 제거
    - `updatePolicyInfo`: 관련 캐시 모두 제거
    - `deletePolicyInfo`: 관련 캐시 모두 제거

## 2. 데이터베이스 최적화

### 2.1 페이지네이션 구현

- `PolicyInfoService`에 페이지네이션 지원 메소드 추가
- `PolicyInfoController`에 페이지네이션 엔드포인트 추가
- 대용량 데이터 조회 시 메모리 사용량 및 응답 시간 개선

### 2.2 데이터베이스 연결 풀 최적화

- HikariCP 설정 최적화
    - `minimum-idle`: 5 → 3 (유휴 연결 수 감소)
    - `maximum-pool-size`: 20 → 10 (최대 연결 수 감소)
    - 연결 타임아웃 및 수명 설정 추가
    - 유휴 연결 제거 시간 설정

### 2.3 JPA/Hibernate 최적화

- `ddl-auto`: create → update (운영 환경에 적합)
- SQL 로깅 및 포맷팅 비활성화
- 배치 처리 최적화 (일괄 삽입/업데이트)
- 쿼리 최적화 설정 추가
- 2차 캐시 및 쿼리 캐시 활성화
- OSIV 패턴 비활성화 (서버 리소스 최적화)

## 3. 파일 처리 최적화

### 3.1 이미지 업로드 최적화

- 파일 크기 및 타입 검증 추가
- 이미지 압축 기능 구현 (스토리지 비용 절감)
- 동시성 제어를 위한 락 사용
- try-with-resources 패턴 적용하여 리소스 누수 방지

### 3.2 파일 삭제 최적화

- 동시성 제어를 위한 락 사용
- 예외 처리 개선

## 4. API 응답 최적화

### 4.1 HTTP 응답 압축

- `WebServerConfig` 클래스 추가하여 Gzip 압축 설정
- 2KB 이상 응답에 대해 압축 적용
- 다양한 MIME 타입에 대한 압축 지원
- 네트워크 대역폭 사용량 감소 및 응답 시간 개선

## 5. 기대 효과

이번 최적화를 통해 다음과 같은 효과를 기대할 수 있습니다:

1. **서버 리소스 사용량 감소**
    - CPU 사용량: 캐싱 및 최적화된 쿼리로 인해 약 30-40% 감소 예상
    - 메모리 사용량: 연결 풀 최적화 및 캐싱으로 약 20-30% 감소 예상
    - 디스크 I/O: 이미지 압축 및 로깅 최적화로 약 40-50% 감소 예상
    - 네트워크 대역폭: 응답 압축 및 캐싱으로 약 30-40% 감소 예상

2. **응답 시간 개선**
    - 캐싱으로 인한 읽기 작업 응답 시간 약 70-80% 감소 예상
    - 페이지네이션으로 인한 대용량 데이터 처리 시간 개선
    - 데이터베이스 최적화로 인한 쓰기 작업 응답 시간 약 20-30% 감소 예상

3. **서버 비용 절감**
    - AWS EC2 인스턴스 크기 축소 가능 (예: t3.medium → t3.small)
    - RDS 인스턴스 크기 축소 가능
    - S3 스토리지 비용 감소 (이미지 압축)
    - 네트워크 전송 비용 감소 (응답 압축)

## 6. 추가 권장사항

1. **모니터링 강화**
    - 캐시 히트율 모니터링
    - 데이터베이스 연결 풀 사용량 모니터링
    - API 응답 시간 모니터링

2. **추가 최적화 가능 영역**
    - CDN 도입 검토 (정적 리소스 제공)
    - 비동기 처리 도입 검토 (대용량 작업)
    - 읽기 전용 복제본 도입 검토 (읽기 작업 분산)
